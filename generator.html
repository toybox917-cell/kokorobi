<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å¿ƒç¯ï½œindex.html è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«ï¼ˆæœˆæƒ…å ±Ã—å¹²æ”¯Ã—å­£ç¯€Ã—é‡ã¿Ã—OGPï¼‰</title>
<style>
  body{font-family:"Hiragino Sans","Yu Gothic",sans-serif;background:#fafafa;color:#333;margin:0;padding:2em}
  h1{text-align:center;margin:0 0 .5em}
  .bar{display:flex;gap:.75em;flex-wrap:wrap;justify-content:center;margin:0 auto 1em}
  .bar>div{display:flex;align-items:center;gap:.5em}
  label{font-weight:bold}
  input[type="date"],select{padding:.45em .65em;border:1px solid #ccc;border-radius:8px}
  button{background:#b48ef7;border:none;color:#fff;padding:.7em 1.2em;border-radius:10px;cursor:pointer;font-size:1rem}
  button:hover{background:#9a77f2}
  textarea{width:100%;height:420px;margin-top:1em;padding:1em;border:1px solid #ccc;border-radius:10px;background:#fff;font-size:.9rem;white-space:pre}
  small{display:block;text-align:center;color:#666;margin-top:.5em}
  .hint{max-width:900px;margin:0 auto 1.25em;color:#555;font-size:.9em;text-align:center}
</style>
</head>
<body>

<h1>ğŸŒ™ å¿ƒç¯ï½œindex.html è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>

<div class="bar">
  <div><label>æ—¥ä»˜ï¼š</label><input type="date" id="dateInput"></div>
  <div><label>å­£ç¯€ãƒ†ãƒ¼ãƒï¼š</label>
    <select id="seasonSelect" title="æœˆã‹ã‚‰è‡ªå‹•åˆ¤å®šï¼ˆæ¨å¥¨ï¼‰">
      <option value="auto" selected>è‡ªå‹•ï¼ˆæ¨å¥¨ï¼‰</option>
      <option value="spring">æ˜¥ï¼ˆ3â€“5æœˆï¼‰</option>
      <option value="summer">å¤ï¼ˆ6â€“8æœˆï¼‰</option>
      <option value="autumn">ç§‹ï¼ˆ9â€“11æœˆï¼‰</option>
      <option value="winter">å†¬ï¼ˆ12â€“2æœˆï¼‰</option>
    </select>
  </div>
  <div><button onclick="generate()">âœ¨ index.html ã‚’ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼</button></div>
</div>

<p class="hint">å¹²æ”¯æ—¥ï¼‹å­£ç¯€ãƒ†ãƒ¼ãƒï¼‹Gistãƒªãƒ³ã‚¯ï¼‹<b>é‡ã¿ä»˜ãâ€œæ—¥æ›¿ã‚ã‚Šâ€ãƒ©ãƒ³ã‚­ãƒ³ã‚°</b>ï¼‹<b>OGP</b>ï¼‹<b>æœˆæƒ…å ±ï¼ˆçµµæ–‡å­—ï¼‹ç”»åƒæç”»ï¼‰</b>å…¥ã‚Šã® index.html ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ï¼ˆJSTåŸºæº–ï¼‰ã€‚</p>

<textarea id="output" readonly placeholder="ã“ã“ã«ç”Ÿæˆã•ã‚ŒãŸ index.html ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
<small>â€» æœˆé½¢ã¯ 2000-01-06 18:14 UTC æ–°æœˆã‚’åŸºæº–ã«è¨ˆç®—ï¼ˆåŒ—åŠçƒï¼æ—¥æœ¬ã®è¦‹ãˆæ–¹ã§æç”»ï¼‰ã€‚</small>

<script>
/* ===== å¹²æ”¯ï¼ˆå®Œå…¨æš¦å¼ JDNï¼‰ ===== */
const STEMS=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
const STEM_YOMI=["ãã®ãˆ","ãã®ã¨","ã²ã®ãˆ","ã²ã®ã¨","ã¤ã¡ã®ãˆ","ã¤ã¡ã®ã¨","ã‹ã®ãˆ","ã‹ã®ã¨","ã¿ãšã®ãˆ","ã¿ãšã®ã¨"];
const BRANCHES=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
const BRANCH_YOMI=["ã­","ã†ã—","ã¨ã‚‰","ã†","ãŸã¤","ã¿","ã†ã¾","ã²ã¤ã˜","ã•ã‚‹","ã¨ã‚Š","ã„ã¬","ã„"];
function jdn(y,m,d){const a=Math.floor((14-m)/2);const y2=y+4800-a;const m2=m+12*a-3;return d+Math.floor((153*m2+2)/5)+365*y2+Math.floor(y2/4)-Math.floor(y2/100)+Math.floor(y2/400)-32045;}
function sexagenaryOfDay(date){const y=date.getFullYear(),m=date.getMonth()+1,d=date.getDate();const N=jdn(y,m,d);const si=(N+9)%10, bi=(N+1)%12;return {stem:STEMS[(si+10)%10],branch:BRANCHES[(bi+12)%12],yomistem:STEM_YOMI[(si+10)%10],yomibr:BRANCH_YOMI[(bi+12)%12]};}

/* ===== å­£ç¯€ãƒ†ãƒ¼ãƒ ===== */
function seasonFromMonth(m){if(m>=3&&m<=5)return"spring"; if(m>=6&&m<=8)return"summer"; if(m>=9&&m<=11)return"autumn"; return"winter";}
function themeFor(season){
  return({
    spring:{gradA:"#fce3ec",gradB:"#e7f7ff",accent:"#b48ef7"},
    summer:{gradA:"#bfe9ff",gradB:"#ffecd2",accent:"#33a1ff"},
    autumn:{gradA:"#ffe1c6",gradB:"#f5f0ff",accent:"#cc7a42"},
    winter:{gradA:"#e8f1ff",gradB:"#f2f6fb",accent:"#6a8fbf"}
  })[season];
}

/* ===== Gistï¼ˆå›ºå®šRaw URLï¼‰ ===== */
const GIST={
  daily:"https://gist.githubusercontent.com/toybox917-cell/5cc5efcc825f7cc57f0e7b49ff9dc7c5/raw",
  weather:"https://gist.githubusercontent.com/toybox917-cell/95124527b68524c2b4d551c7cbb5a14b/raw",
  topics:"https://gist.githubusercontent.com/toybox917-cell/3499c5dfebf2462208ad234120be087a/raw",
  lucky:"https://gist.githubusercontent.com/toybox917-cell/ffbaf45b1edb1c11d2a3e814e76066fa/raw",
  ranking:"https://gist.githubusercontent.com/toybox917-cell/c344ff836842c63913079d0a3637f1fb/raw",
  blogs:[
    "https://gist.githubusercontent.com/toybox917-cell/77f34ebf969517f68d842b7be379b7fa/raw",
    "https://gist.githubusercontent.com/toybox917-cell/5fedbdbfd6464f26351946495e472eb6/raw",
    "https://gist.githubusercontent.com/toybox917-cell/435d9bc589b417dcdc4c4e83d0a4b2c2/raw"
  ]
};

/* ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚°é‡ã¿ï¼†ã‚·ãƒ¼ãƒ‰ ===== */
const ZODIAC_ORDER=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
const BASE_WEIGHTS={å­:1.0,ä¸‘:0.95,å¯…:0.98,å¯:0.97,è¾°:1.02,å·³:0.96,åˆ:0.94,æœª:0.99,ç”³:1.03,é…‰:1.0,æˆŒ:0.92,äº¥:0.98};
function seededRandom(seed){let t=seed+0x9e3779b97f4a7c15n;return()=>{t^=t>>12n;t^=t<<25n;t^=t>>27n;const n=(t*0x2545F4914F6CDD1Dn)&((1n<<64n)-1n);return Number(n>>11n)/Number(1n<<53n);}}

/* ===== æœˆé½¢ï¼ˆJSTï¼‰ ===== */
function toJSTDate(date){const tz="Asia/Tokyo";const p=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(date);const y=p.find(v=>v.type==='year').value,m=p.find(v=>v.type==='month').value,d=p.find(v=>v.type==='day').value;return new Date(`${y}-${m}-${d}T00:00:00+09:00`);}
function moonPhase(dateJST){const syn=29.530588853;const base=new Date(Date.UTC(2000,0,6,18,14));const diff=(dateJST-base)/86400000;const phase=((diff%syn)+syn)%syn;const illumination=Math.round((1-Math.cos(2*Math.PI*phase/syn))*50);return {phase,illumination};}
function moonEmoji(ph){if(ph<1.5)return"ğŸŒ‘";if(ph<6)return"ğŸŒ’";if(ph<8)return"ğŸŒ“";if(ph<14)return"ğŸŒ”";if(ph<16)return"ğŸŒ•";if(ph<21)return"ğŸŒ–";if(ph<23)return"ğŸŒ—";return"ğŸŒ˜";}
function moonLabel(ph){if(ph<1.5)return"æ–°æœˆã«è¿‘ã„æœˆ";if(ph<6)return"ä¸‰æ—¥æœˆï¼ˆæº€ã¡ï¼‰";if(ph<8)return"ä¸Šå¼¦ã®æœˆ";if(ph<14)return"æº€ã¡ã‚†ãæœˆ";if(ph<16)return"æº€æœˆ";if(ph<21)return"æ¬ ã‘ã‚†ãæœˆ";if(ph<23)return"ä¸‹å¼¦ã®æœˆ";return"æ–°æœˆå‰ã®æœˆ";}
function drawMoon(canvas,phase){
  const ctx=canvas.getContext('2d'),w=canvas.width,h=canvas.height,cx=w/2,cy=h/2,r=Math.min(w,h)*0.38;
  ctx.fillStyle="#000";ctx.fillRect(0,0,w,h);
  for(let i=0;i<60;i++){const x=Math.random()*w,y=Math.random()*h,a=0.5+Math.random()*0.5;ctx.fillStyle=`rgba(255,255,255,${a*0.5})`;ctx.fillRect(x,y,1,1);}
  ctx.fillStyle="#0a0a12";ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.fill();
  const syn=29.530588853,k=(phase<=syn/2)?(phase/(syn/2)):(1-(phase-syn/2)/(syn/2)),dir=(phase<=syn/2)?1:-1,dx=dir*(r*(1-(2*k-1)));
  ctx.save();ctx.globalCompositeOperation="lighter";const grd=ctx.createRadialGradient(cx+dx,cy,r*0.1,cx,cy,r*1.05);grd.addColorStop(0,"#f8f6ea");grd.addColorStop(1,"#999382");ctx.fillStyle=grd;ctx.beginPath();ctx.arc(cx+dx,cy,r,0,Math.PI*2);ctx.fill();ctx.restore();
  ctx.save();ctx.globalAlpha=0.08;ctx.strokeStyle="#fff";ctx.lineWidth=6;ctx.beginPath();ctx.arc(cx,cy,r+3,0,Math.PI*2);ctx.stroke();ctx.restore();
}

/* ===== ç”Ÿæˆæœ¬ä½“ ===== */
function generate(){
  const raw=document.getElementById("dateInput").value;
  const jsDate = raw? new Date(raw+"T00:00:00") : new Date();
  const jst=toJSTDate(jsDate);

  const wArr=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"], w=wArr[jst.getDay()];
  const todayJP=`${jst.getFullYear()}å¹´${jst.getMonth()+1}æœˆ${jst.getDate()}æ—¥ï¼ˆ${w}ï¼‰`;
  const eto=sexagenaryOfDay(jst);
  const pick=document.getElementById("seasonSelect").value;
  const season=(pick==="auto")? seasonFromMonth(jst.getMonth()+1) : pick;
  const theme=themeFor(season);

  const m=moonPhase(jst), emoji=moonEmoji(m.phase);

  const OGP_TITLE="å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„";
  const OGP_DESC="ç†ã§å°ãã€ã‚„ã•ã—ã•ã§åŒ…ã‚€â€”â€”æ¯æ—¥ã®â€œå®™ã®å¤©æ°—â€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡ã€‚";
  const OGP_URL="https://kokorobi.vercel.app/";
  const OGP_IMG="https://kokorobi.vercel.app/og.png";

  const html = `
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${OGP_TITLE}</title>
<meta name="description" content="${OGP_DESC}">
<link rel="canonical" href="${OGP_URL}">
<meta name="theme-color" content="${theme.accent}">
<!-- OGP -->
<meta property="og:type" content="website">
<meta property="og:title" content="${OGP_TITLE}">
<meta property="og:description" content="${OGP_DESC}">
<meta property="og:url" content="${OGP_URL}">
<meta property="og:image" content="${OGP_IMG}">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="${OGP_TITLE}">
<meta name="twitter:description" content="${OGP_DESC}">
<meta name="twitter:image" content="${OGP_IMG}">
<style>
  :root{ --accent:${theme.accent}; }
  body{font-family:"Hiragino Sans","Yu Gothic",sans-serif;background:#0a0a12;color:#eaeaf2;margin:0;}
  header{text-align:center;padding:2em 1em;background:linear-gradient(135deg,${theme.gradA},${theme.gradB});color:#222;}
  header h1{margin:0;font-size:2em;}
  header p{margin:.4em 0 0;font-size:.95em;color:#333;}
  .sub{margin-top:.25em;color:#444;font-size:.9em}
  .moon-wrap{display:flex;flex-direction:column;align-items:center;gap:.5em;margin-top:.75em}
  .moon-info{font-size:.9em;color:#333}
  .moon-canvas{background:#000;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.4)}
  section{max-width:720px;margin:2em auto;padding:1.5em;background:#12121a;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.3);}
  section h2{border-left:6px solid var(--accent);padding-left:.5em;font-size:1.15em;color:#eaeaf2;}
  .ranking-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .rank-item{border:1px solid #2a2a36;border-radius:10px;padding:.6em;background:#0f0f16;}
  .rank-item .no{font-weight:bold;color:#c7b6ff;}
  .meta{font-size:.8em;color:#b8b8c6;}
  table{width:100%;border-collapse:collapse;color:#ddd;}
  th,td{border:1px solid #2a2a36;padding:.5em;text-align:left;}
  th{background:#1b1b26;width:30%;}
  footer{text-align:center;font-size:.8em;color:#aaa;margin:3em 0 2em;}
  .loading{text-align:center;color:#888;font-size:.9em;}
</style>
</head>
<body>

<header>
  <h1>å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</h1>
  <p>ç†ã§å°ãã€ã‚„ã•ã—ã•ã§åŒ…ã‚€ â€” å¿ƒã®èª¿å¾‹</p>
  <p class="sub">ğŸŒ™ æœ¬æ—¥ï¼š${todayJP} ï¼ ğŸ‰ å¹²æ”¯æ—¥ï¼š${eto.stem}${eto.branch}ï¼ˆ${eto.yomistem}ã®${eto.yomibr}ï¼‰</p>
  <div class="moon-wrap">
    <canvas id="moon-canvas" class="moon-canvas" width="260" height="260"></canvas>
    <p id="moon-info" class="moon-info">${emoji} ä»Šå¤œã®æœˆï¼š${moonLabel(m.phase)}ï¼ˆç…§åº¦${m.illumination}%ï¼‰</p>
  </div>
</header>

<main>
  <section id="daily"><h2>ğŸŒ• ä»Šæ—¥ã®ç¯</h2><div id="daily-content" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section id="weather"><h2>ğŸŒ¤ å®™ã®å¤©æ°—ï¼ˆå¹²æ”¯Ã—äº”è¡Œï¼‰</h2><div id="weather-content" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section id="topics"><h2>ğŸ”® ä¸‰å¤§é‹ãƒˆãƒ”ãƒƒã‚¯</h2><ul id="topics-content" class="loading"></ul></section>
  <section id="lucky"><h2>ğŸ€ ã‚¯ã‚¤ãƒƒã‚¯é–‹é‹ãƒ‘ãƒãƒ«</h2><table id="lucky-content" class="loading"></table></section>
  <section id="ranking"><h2>ğŸ‰ å¹²æ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆé‡ã¿ä»˜ããƒ»æ—¥æ›¿ã‚ã‚Šï¼‰</h2><div id="ranking-content" class="ranking-grid loading"></div></section>
  <section id="blog"><h2>ğŸ’« å¿ƒã®èª¿å¾‹ãƒãƒ¼ãƒˆ</h2><div id="blog-content" class="loading"></div></section>
</main>

<footer><p>Â© å¿ƒç¯ â€“ å®™ã®ãƒªã‚ºãƒ å ã„</p></footer>

<script>
const GIST=${JSON.stringify(GIST,null,2)};

// Gistãƒ­ãƒ¼ãƒ‰
async function loadContent(id,url){try{const r=await fetch(url);if(!r.ok)throw 0;document.getElementById(id).innerHTML=await r.text();}catch{document.getElementById(id).innerHTML='<p style="color:#999;">âš ï¸ èª­ã¿è¾¼ã¿ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>';}}
loadContent("daily-content",GIST.daily);
loadContent("weather-content",GIST.weather);
loadContent("topics-content",GIST.topics);
loadContent("lucky-content",GIST.lucky);

// æœˆæç”»
(function(){const c=document.getElementById('moon-canvas'); if(c){drawMoon(c, ${/* ãã®æ—¥ã®phaseã§æç”» */''} ${'m.phase'} );}})();

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼šé‡ã¿ä»˜ããƒ»æ—¥æ›¿ã‚ã‚Š
(async()=>{
  try{
    const res=await fetch(GIST.ranking); const raw=await res.text();
    const tmp=document.createElement('div'); tmp.innerHTML=raw;
    let items=[...tmp.querySelectorAll('.rank-item')];

    function getZodiac(el){const t=el.textContent||"";for(const z of ${JSON.stringify(ZODIAC_ORDER)}){if(t.includes(z))return z;}return null;}

    const y=${'new Date().getFullYear()'}, mo=${'new Date().getMonth()+1'}, d=${'new Date().getDate()'};
    const seedBigInt=BigInt(jdn(y,mo,d)); let rnd=seededRandom(seedBigInt);

    const base=${JSON.stringify(BASE_WEIGHTS)};
    const scored=items.map(el=>{const z=getZodiac(el)||"å­";return {el,score:(base[z]||1.0)*(0.5+rnd())};}).sort((a,b)=>b.score-a.score);

    const grid=document.createElement('div'); grid.className='ranking-grid';
    scored.forEach((s,i)=>{const no=i+1;const n=s.el.querySelector('.no');if(n){n.textContent='#'+no+' '+n.textContent.replace(/^#\\d+\\s*/,'').trim();}grid.appendChild(s.el);});
    const host=document.getElementById('ranking-content'); host.classList.remove('loading'); host.innerHTML=''; host.appendChild(grid);
  }catch{document.getElementById('ranking-content').innerHTML='<p style="color:#999;">âš ï¸ èª­ã¿è¾¼ã¿ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>'; }
})();

// ãƒ–ãƒ­ã‚°3ä»¶
(async()=>{let html="";for(const url of GIST.blogs){try{const r=await fetch(url),t=await r.text();const [title,...rest]=t.split("\\n");html+=\`<article style="margin-bottom:1.5em;"><h3 style="margin:0 0 .2em;color:#c7b6ff;">\${title||"ç„¡é¡Œ"}</h3><p style="margin:0;font-size:.9em;color:#ccc;">\${rest.join("<br>")}</p></article>\`; }catch{ html+='<p style="color:#999;">âš ï¸ èª­ã¿è¾¼ã¿ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>'; } } document.getElementById("blog-content").innerHTML=html||'<p class="loading">ï¼ˆè¨˜äº‹æº–å‚™ä¸­ï¼‰</p>';})();
</script>

</body>
</html>
  `.trim();

  const ta=document.getElementById("output");
  ta.value=html; ta.focus(); ta.select();
  try{ document.execCommand("copy"); alert("âœ… ç”Ÿæˆã—ãŸ index.html ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼GitHubã® index.html ã«è²¼ã‚Šæ›¿ãˆã¦ Commit ã—ã¦ãã ã•ã„ã€‚"); }
  catch{ alert("ç”Ÿæˆã¯æˆåŠŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚"); }
}

// æ—¢å®šï¼šä»Šæ—¥
(function(){const input=document.getElementById("dateInput");const t=new Date();const pad=n=>String(n).padStart(2,"0");input.value=`${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())}`;})();
</script>

<!-- ï¼ˆä»»æ„ï¼‰ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’Gistã‹ã‚‰ä¾›çµ¦ã™ã‚‹å ´åˆã¯ã€æ¬¡ã®1è¡Œã‚’ </body> ç›´å‰ã«ç½®ã -->
<!-- <script src="https://gist.github.com/toybox917-cell/f680e539e8421b1910d4550535038f75.js"></script> -->

</body>
</html>
