<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å¿ƒç¯ï½œindex.html è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
<style>
  body{font-family:"Hiragino Sans","Yu Gothic",sans-serif;background:#fafafa;color:#333;margin:0;padding:2em}
  h1{text-align:center;margin:0 0 .5em}
  .bar{display:flex;gap:.75em;flex-wrap:wrap;justify-content:center;margin:0 auto 1em}
  .bar>div{display:flex;align-items:center;gap:.5em}
  label{font-weight:bold}
  input[type="date"],select{padding:.45em .65em;border:1px solid #ccc;border-radius:8px}
  button{background:#b48ef7;border:none;color:#fff;padding:.7em 1.2em;border-radius:10px;cursor:pointer;font-size:1rem}
  button:hover{background:#9a77f2}
  textarea{width:100%;height:420px;margin-top:1em;padding:1em;border:1px solid #ccc;border-radius:10px;background:#fff;font-size:.9rem;white-space:pre}
  small{display:block;text-align:center;color:#666;margin-top:.5em}
  .hint{max-width:900px;margin:0 auto 1.25em;color:#555;font-size:.9em;text-align:center}
</style>
</head>
<body>

<h1>ğŸŒ™ å¿ƒç¯ï½œindex.html è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>

<div class="bar">
  <div><label>æ—¥ä»˜ï¼š</label><input type="date" id="dateInput"></div>
  <div><label>å­£ç¯€ãƒ†ãƒ¼ãƒï¼š</label>
    <select id="seasonSelect">
      <option value="auto" selected>è‡ªå‹•ï¼ˆæ¨å¥¨ï¼‰</option>
      <option value="spring">æ˜¥</option>
      <option value="summer">å¤</option>
      <option value="autumn">ç§‹</option>
      <option value="winter">å†¬</option>
    </select>
  </div>
  <div><button onclick="generate()">âœ¨ index.html ã‚’ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼</button></div>
</div>

<p class="hint">
å¹²æ”¯ãƒ»æœˆé½¢ãƒ»å­£ç¯€ãƒ†ãƒ¼ãƒãƒ»Gistãƒªãƒ³ã‚¯ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚<br>
ã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸHTMLã‚’ <b>index.html</b> ã«è²¼ã‚Šä»˜ã‘ã¦ Commit ã™ã‚Œã°å…¬é–‹å®Œäº†ã§ã™ã€‚
</p>

<textarea id="output" readonly placeholder="ã“ã“ã«ç”Ÿæˆã•ã‚ŒãŸ index.html ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>

<script>
// å¹²æ”¯ç®—å‡º
const STEMS=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
const BRANCHES=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
function jdn(y,m,d){const a=Math.floor((14-m)/12);y=y+4800-a;m=m+12*a-3;return d+Math.floor((153*m+2)/5)+365*y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400)-32045;}
function sexagenary(y,m,d){const jd=jdn(y,m,d);return STEMS[(jd+9)%10]+BRANCHES[(jd+1)%12];}

// æœˆé½¢ï¼ˆç°¡æ˜“ï¼‰
function moonPhase(date){
  const syn=29.530588853;
  const base=new Date(Date.UTC(2000,0,6,18,14));
  const diff=(date-base)/86400000;
  const phase=((diff%syn)+syn)%syn;
  if(phase<1.5)return"ğŸŒ‘";
  if(phase<6)return"ğŸŒ’";
  if(phase<8)return"ğŸŒ“";
  if(phase<14)return"ğŸŒ”";
  if(phase<16)return"ğŸŒ•";
  if(phase<21)return"ğŸŒ–";
  if(phase<23)return"ğŸŒ—";
  return"ğŸŒ˜";
}

// Gistãƒªãƒ³ã‚¯
const GIST={
  daily:"https://gist.githubusercontent.com/toybox917-cell/5cc5efcc825f7cc57f0e7b49ff9dc7c5/raw",
  weather:"https://gist.githubusercontent.com/toybox917-cell/95124527b68524c2b4d551c7cbb5a14b/raw",
  topics:"https://gist.githubusercontent.com/toybox917-cell/3499c5dfebf2462208ad234120be087a/raw",
  lucky:"https://gist.githubusercontent.com/toybox917-cell/ffbaf45b1edb1c11d2a3e814e76066fa/raw",
  ranking:"https://gist.githubusercontent.com/toybox917-cell/c344ff836842c63913079d0a3637f1fb/raw",
  blogs:[
    "https://gist.githubusercontent.com/toybox917-cell/77f34ebf969517f68d842b7be379b7fa/raw",
    "https://gist.githubusercontent.com/toybox917-cell/5fedbdbfd6464f26351946495e472eb6/raw",
    "https://gist.githubusercontent.com/toybox917-cell/435d9bc589b417dcdc4c4e83d0a4b2c2/raw"
  ]
};

// ç”Ÿæˆå‡¦ç†
function generate(){
  const raw=document.getElementById("dateInput").value;
  const date=raw?new Date(raw+"T00:00:00"):new Date();
  const wdays=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  const w=wdays[date.getDay()];
  const y=date.getFullYear(),m=date.getMonth()+1,d=date.getDate();
  const eto=sexagenary(y,m,d);
  const moon=moonPhase(date);
  const seasonSel=document.getElementById("seasonSelect").value;
  const season=seasonSel==="auto"?(m>=3&&m<=5?"spring":m>=6&&m<=8?"summer":m>=9&&m<=11?"autumn":"winter"):seasonSel;
  const accent={spring:"#b48ef7",summer:"#33a1ff",autumn:"#cc7a42",winter:"#6a8fbf"}[season];

  const html=`<!DOCTYPE html>
<html lang="ja"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</title>
<meta name="description" content="ç†ã§å°ãã€ã‚„ã•ã—ã•ã§åŒ…ã‚€â€”â€”æ¯æ—¥ã®â€œå®™ã®å¤©æ°—â€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡ã€‚">
<meta property="og:image" content="https://kokorobi.vercel.app/og.png">
<style>
body{font-family:"Hiragino Sans","Yu Gothic",sans-serif;background:#0a0a12;color:#eee;margin:0}
header{text-align:center;padding:2em;background:linear-gradient(135deg,${accent},#fff);}
section{max-width:720px;margin:2em auto;padding:1.5em;background:#12121a;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.3);}
h2{border-left:6px solid ${accent};padding-left:.5em;font-size:1.1em;}
.loading{text-align:center;color:#999;}
footer{text-align:center;font-size:.8em;color:#aaa;margin:2em 0;}
</style></head>
<body>
<header>
<h1>å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</h1>
<p>${y}å¹´${m}æœˆ${d}æ—¥ï¼ˆ${w}ï¼‰ã€€å¹²æ”¯æ—¥ï¼š${eto}</p>
<p>ä»Šå¤œã®æœˆï¼š${moon}</p>
</header>
<main>
<section><h2>ğŸŒ• ä»Šæ—¥ã®ç¯</h2><div id="daily" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
<section><h2>ğŸŒ¤ å®™ã®å¤©æ°—</h2><div id="weather" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
<section><h2>ğŸ”® ä¸‰å¤§é‹ãƒˆãƒ”ãƒƒã‚¯</h2><div id="topics" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
<section><h2>ğŸ€ ã‚¯ã‚¤ãƒƒã‚¯é–‹é‹</h2><div id="lucky" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
<section><h2>ğŸ‰ å¹²æ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2><div id="ranking" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
<section><h2>ğŸ’« å¿ƒã®èª¿å¾‹ãƒãƒ¼ãƒˆ</h2><div id="blogs" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
</main>
<footer>Â© å¿ƒç¯ â€“ å®™ã®ãƒªã‚ºãƒ å ã„</footer>
<script>
async function load(id,url){try{const r=await fetch(url);if(!r.ok)throw 0;document.getElementById(id).innerHTML=await r.text();}catch{document.getElementById(id).innerText='âš ï¸ èª­ã¿è¾¼ã¿å¤±æ•—';}}
load("daily","${GIST.daily}");
load("weather","${GIST.weather}");
load("topics","${GIST.topics}");
load("lucky","${GIST.lucky}");
load("ranking","${GIST.ranking}");
(async()=>{let html='';for(const u of ${JSON.stringify(GIST.blogs)}){try{const r=await fetch(u);const t=await r.text();const [h,...b]=t.split("\\n");html+=\`<article><h3>\${h}</h3><p>\${b.join("<br>")}</p></article>\`; }catch{}}document.getElementById('blogs').innerHTML=html||'è¨˜äº‹æº–å‚™ä¸­';})();
</script>
</body></html>`;

  const out=document.getElementById("output");
  out.value=html;
  out.select();
  document.execCommand("copy");
  alert("âœ… index.html ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ GitHubã§è²¼ã‚Šä»˜ã‘ã¦Commitã™ã‚Œã°å®Œäº†ã§ã™ã€‚");
}

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ã‚»ãƒƒãƒˆ
(function(){const d=new Date(),pad=n=>String(n).padStart(2,"0");document.getElementById("dateInput").value=\`\${d.getFullYear()}-\${pad(d.getMonth()+1)}-\${pad(d.getDate())}\`;})();
</script>
</body>
</html>
