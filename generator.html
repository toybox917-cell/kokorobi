<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¿ƒç¯ï½œindex.html è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«ï¼ˆå®‰å®šç‰ˆï¼‰</title>
<style>
  body{font-family:"Hiragino Sans","Yu Gothic",sans-serif;margin:0;background:#fafafa;color:#333}
  header{padding:20px 16px;text-align:center;background:#fff;border-bottom:1px solid #eee}
  main{max-width:920px;margin:20px auto;padding:0 16px}
  .bar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:12px}
  input[type="date"],select{padding:.5em .7em;border:1px solid #ccc;border-radius:8px}
  button{background:#8257e6;color:#fff;border:none;border-radius:10px;padding:.7em 1.2em;cursor:pointer}
  button:hover{background:#6e47de}
  textarea{width:100%;height:440px;border:1px solid #ddd;border-radius:10px;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace}
  small{color:#666}
</style>
</head>
<body>
<header>
  <h1 style="margin:0">ğŸŒ™ å¿ƒç¯ï½œindex.html è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
  <p style="margin:.3em 0 0;color:#555">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã« <b>index.html</b> ãŒå‡ºã¾ã™ï¼ˆè‡ªå‹•ã‚³ãƒ”ãƒ¼ä»˜ãï¼‰</p>
</header>

<main>
  <div class="bar">
    <label>æ—¥ä»˜ï¼š<input type="date" id="dateInput"></label>
    <label>å­£ç¯€ï¼š 
      <select id="season">
        <option value="auto" selected>è‡ªå‹•ï¼ˆæ¨å¥¨ï¼‰</option>
        <option value="spring">æ˜¥</option>
        <option value="summer">å¤</option>
        <option value="autumn">ç§‹</option>
        <option value="winter">å†¬</option>
      </select>
    </label>
    <button id="genBtn" type="button">âœ¨ index.html ã‚’ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼</button>
  </div>

  <textarea id="out" placeholder="ã“ã“ã«ç”Ÿæˆã•ã‚ŒãŸ index.html ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
  <p><small>â€» ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ãŸå ´åˆã¯ã€ã“ã®æ ã®ä¸­èº«ã‚’å…¨é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚</small></p>
</main>

<script>
// åˆæœŸæ—¥ä»˜ã‚»ãƒƒãƒˆï¼ˆJSTã®ä»Šæ—¥ï¼‰
(function(){const d=new Date();const pad=n=>String(n).padStart(2,"0");document.getElementById('dateInput').value=`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;})();

// å¹²æ”¯ï¼ˆç°¡ç•¥ãƒ»å®‰å®šï¼‰
const STEMS=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
const BRANCHES=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
function jdn(y,m,d){const a=Math.floor((14-m)/12);y=y+4800-a;m=m+12*a-3;return d+Math.floor((153*m+2)/5)+365*y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400)-32045;}
function etoOf(y,m,d){const jd=jdn(y,m,d);return STEMS[(jd+9)%10]+BRANCHES[(jd+1)%12];}

// æœˆï¼ˆçµµæ–‡å­—ã®ã¿ãƒ»å®‰å®šï¼‰
function moonEmoji(date){
  const syn=29.530588853;
  const base=new Date(Date.UTC(2000,0,6,18,14));
  const diff=(date-base)/86400000;
  const ph=((diff%syn)+syn)%syn;
  if(ph<1.5)return"ğŸŒ‘";
  if(ph<6)return"ğŸŒ’";
  if(ph<8)return"ğŸŒ“";
  if(ph<14)return"ğŸŒ”";
  if(ph<16)return"ğŸŒ•";
  if(ph<21)return"ğŸŒ–";
  if(ph<23)return"ğŸŒ—";
  return"ğŸŒ˜";
}

// Gistï¼ˆå†…å®¹ãƒ‡ãƒ¼ã‚¿ï¼‰
const GIST={
  daily:"https://gist.githubusercontent.com/toybox917-cell/5cc5efcc825f7cc57f0e7b49ff9dc7c5/raw",
  weather:"https://gist.githubusercontent.com/toybox917-cell/95124527b68524c2b4d551c7cbb5a14b/raw",
  topics:"https://gist.githubusercontent.com/toybox917-cell/3499c5dfebf2462208ad234120be087a/raw",
  lucky:"https://gist.githubusercontent.com/toybox917-cell/ffbaf45b1edb1c11d2a3e814e76066fa/raw",
  ranking:"https://gist.githubusercontent.com/toybox917-cell/c344ff836842c63913079d0a3637f1fb/raw",
  blogs:[
    "https://gist.githubusercontent.com/toybox917-cell/77f34ebf969517f68d842b7be379b7fa/raw",
    "https://gist.githubusercontent.com/toybox917-cell/5fedbdbfd6464f26351946495e472eb6/raw",
    "https://gist.githubusercontent.com/toybox917-cell/435d9bc589b417dcdc4c4e83d0a4b2c2/raw"
  ]
};

// å­£ç¯€è‰²
function seasonAccent(m,sel){
  const key = sel==="auto" ? (m>=3&&m<=5?"spring":m>=6&&m<=8?"summer":m>=9&&m<=11?"autumn":"winter") : sel;
  return ({spring:"#b48ef7",summer:"#33a1ff",autumn:"#cc7a42",winter:"#6a8fbf"})[key];
}

// index.html ã®ç”Ÿæˆ
function buildHTML(dateStr, seasonSel){
  const d = dateStr ? new Date(dateStr+"T00:00:00") : new Date();
  const y=d.getFullYear(), m=d.getMonth()+1, dd=d.getDate();
  const w=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][d.getDay()];
  const eto=etoOf(y,m,dd);
  const moon=moonEmoji(d);
  const accent=seasonAccent(m, seasonSel);

  return `<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</title>
<meta name="description" content="ç†ã§å°ãã€ã‚„ã•ã—ã•ã§åŒ…ã‚€â€”â€”æ¯æ—¥ã®â€œå®™ã®å¤©æ°—â€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡ã€‚">
<meta property="og:image" content="https://kokorobi.vercel.app/og.png">
<style>
  body{font-family:"Hiragino Sans","Yu Gothic",sans-serif;background:#0a0a12;color:#eee;margin:0}
  header{text-align:center;padding:2em;background:linear-gradient(135deg,${accent},#ffffff)}
  main{max-width:760px;margin:2em auto;padding:0 16px}
  section{background:#12121a;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.35);padding:16px;margin:14px 0}
  h2{border-left:6px solid ${accent};padding-left:.5em;font-size:1.05rem;margin:.2em 0 .6em}
  .loading{color:#999}
  footer{text-align:center;color:#aaa;font-size:.85em;margin:2em 0}
</style>
</head>
<body>
<header>
  <h1>å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</h1>
  <p>${y}å¹´${m}æœˆ${dd}æ—¥ï¼ˆ${w}ï¼‰ã€€å¹²æ”¯æ—¥ï¼š${eto}ã€€ä»Šå¤œã®æœˆï¼š${moon}</p>
</header>
<main>
  <section><h2>ğŸŒ• ä»Šæ—¥ã®ç¯</h2><div id="daily" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section><h2>ğŸŒ¤ å®™ã®å¤©æ°—ï¼ˆå¹²æ”¯Ã—äº”è¡Œï¼‰</h2><div id="weather" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section><h2>ğŸ”® ä¸‰å¤§é‹ãƒˆãƒ”ãƒƒã‚¯</h2><div id="topics" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section><h2>ğŸ€ ã‚¯ã‚¤ãƒƒã‚¯é–‹é‹ãƒ‘ãƒãƒ«</h2><div id="lucky" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section><h2>ğŸ‰ å¹²æ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2><div id="ranking" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
  <section><h2>ğŸ’« å¿ƒã®èª¿å¾‹ãƒãƒ¼ãƒˆ</h2><div id="blogs" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></section>
</main>
<footer>Â© å¿ƒç¯ â€“ å®™ã®ãƒªã‚ºãƒ å ã„</footer>
<script>
async function load(id,url){try{const r=await fetch(url,{cache:"no-store"});if(!r.ok)throw 0;document.getElementById(id).innerHTML=await r.text();}catch{document.getElementById(id).textContent="âš ï¸ èª­ã¿è¾¼ã¿ã§ãã¾ã›ã‚“ã§ã—ãŸ";}}
load("daily","${GIST.daily}");
load("weather","${GIST.weather}");
load("topics","${GIST.topics}");
load("lucky","${GIST.lucky}");
load("ranking","${GIST.ranking}");
(async()=>{let html="";for(const u of ${JSON.stringify(GIST.blogs)}){try{const r=await fetch(u,{cache:"no-store"});const t=await r.text();const [h,...b]=t.split("\\n");html+=\`<article style="margin-bottom:1em"><h3 style="margin:.2em 0;color:#c7b6ff">\${h||"ç„¡é¡Œ"}</h3><p style="margin:0">\${b.join("<br>")}</p></article>\`;}catch{}}document.getElementById("blogs").innerHTML=html||"ï¼ˆè¨˜äº‹æº–å‚™ä¸­ï¼‰";})();
</script>
</body>
</html>`;
}

// ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ï¼ˆiPhoneå¯¾ç­–ã¤ãï¼‰
async function copyText(text){
  try{
    if(navigator.clipboard && window.isSecureContext){
      await navigator.clipboard.writeText(text);
      return true;
    }
  }catch(e){}
  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  try{
    const ta=document.createElement("textarea");
    ta.value=text; ta.style.position="fixed"; ta.style.opacity="0";
    document.body.appendChild(ta); ta.focus(); ta.select();
    const ok=document.execCommand("copy"); document.body.removeChild(ta);
    return ok;
  }catch(e){ return false; }
}

// ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå¿…ãšåå¿œï¼‰
document.getElementById("genBtn").addEventListener("click", async ()=>{
  try{
    const dateStr=document.getElementById("dateInput").value;
    const season=document.getElementById("season").value;
    const html=buildHTML(dateStr, season);
    const out=document.getElementById("out");
    out.value = html; // ã¾ãšç”»é¢ã«ç¢ºå®Ÿã«å‡ºã™
    const ok = await copyText(html);
    alert(ok ? "âœ… ç”Ÿæˆï¼†ã‚³ãƒ”ãƒ¼å®Œäº†ï¼\nâ†’ index.html ã«å…¨è²¼ã‚Šæ›¿ãˆã—ã¦ Commit ã—ã¦ãã ã•ã„ã€‚" 
             : "âœ… ç”ŸæˆOKï¼\nâ• ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ãŸã®ã§ã€æ ã®ä¸­èº«ã‚’æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
  }catch(err){
    console.error(err);
    alert("âŒ ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/ãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ã®å¯èƒ½æ€§ï¼‰ã€‚è¡¨ç¤ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚");
  }
});
</script>
</body>
</html>
