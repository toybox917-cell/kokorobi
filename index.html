<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</title>
<meta name="description" content="æ¯æ—¥ã®â€œå®™ã®å¤©æ°—â€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚é€±å ã„ãƒ»æœˆå ã„ãƒ»ä»Šæ—¥ã®è‰²ãƒ»å¹²æ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ç”Ÿå¹´æœˆæ—¥ã‚¯ã‚¤ãƒƒã‚¯å ã„ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰ã€‚">
<link rel="canonical" href="https://kokorobi.vercel.app/">
<meta property="og:type" content="website">
<meta property="og:title" content="å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„">
<meta property="og:url" content="https://kokorobi.vercel.app/">
<meta property="og:image" content="https://kokorobi.vercel.app/og.png">
<meta name="theme-color" content="#8888ff">
<style>
:root{
  --accent:#7aa1ff; --lucky:#8ad; --card:#12121a;
  --ink:#eaeaf2; --ink-soft:#cfd3ff;
  --ink-day:#222; --ink-day-soft:#333;
  --card-day:#f9f9fb; --card-day-border:#ccc;
}
*{box-sizing:border-box}
body{margin:0;background:#0a0a12;color:var(--ink);
  font-family:"Hiragino Sans","Yu Gothic",system-ui,-apple-system,sans-serif}
main{max-width:820px;margin:22px auto;padding:0 16px}
section{background:var(--card);border:1px solid #222;border-radius:12px;
  padding:16px;margin:16px 0;box-shadow:0 2px 10px rgba(0,0,0,.35)}
h2{margin:.2em 0 .6em;font-size:1.1rem;border-left:6px solid var(--accent);padding-left:.5em}
.daily{white-space:pre-wrap;line-height:1.85}
footer{text-align:center;color:#aaa;font-size:.85rem;margin:28px 0}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ */
.sky{position:relative;text-align:center;padding:28px 14px 18px;overflow:hidden}
body.day .sky{background:linear-gradient(135deg,#f7f3ff,#eaf7ff)}
body.night .sky{background:radial-gradient(circle at 50% -10%,#23335a,#0b0f1a 60%)}
.moon{width:92px;height:92px;margin:10px auto 6px;border-radius:50%;
  animation:breathe 5.5s ease-in-out infinite;position:relative;z-index:2}
body.day .moon{background:radial-gradient(circle at 35% 35%,#ffe066,#f2c14e 60%,#b3862f 100%);
  box-shadow:0 0 26px rgba(255,214,82,.45)}
body.night .moon{background:radial-gradient(circle at 35% 35%,#e6f0ff,#a8c2ff 60%,#6f86d6 100%);
  box-shadow:0 0 30px rgba(120,160,255,.40),0 0 60px rgba(120,160,255,.20)}
@keyframes breathe{0%,100%{transform:scale(.96)}50%{transform:scale(1.06)}}
.ripple{position:absolute;top:50%;left:50%;width:92px;height:92px;transform:translate(-50%,-50%);
  border-radius:50%;z-index:1;pointer-events:none}
body.night .ripple::before, body.night .ripple::after{content:"";position:absolute;inset:0;border-radius:50%;
  border:2px solid rgba(200,220,255,.35);animation:waveN 6s ease-in-out infinite}
body.night .ripple::after{animation-delay:3s}
@keyframes waveN{0%{transform:scale(1);opacity:.45}70%{opacity:.1}100%{transform:scale(3);opacity:0}}
body.day .ripple::before, body.day .ripple::after{content:"";position:absolute;inset:0;border-radius:50%;
  border:2px solid rgba(255,225,120,.40);box-shadow:0 0 20px rgba(255,210,90,.22) inset;animation:waveD 7.5s ease-in-out infinite}
body.day .ripple::after{animation-delay:3.75s}
.title{font-size:1.6rem;margin:.2em 0 .25em}
.date,.info{margin:.2em 0 0}
.btn-ghost{appearance:none;background:#1118;border:1px solid #333;color:#dfe3ff;padding:6px 10px;border-radius:999px;font-size:.9rem}

/* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ï¼‰ */
.rank-grid{display:grid;grid-template-columns:1fr;gap:10px}
.rank-card{background:#0f0f16;border:1px solid #23232f;border-radius:10px;padding:12px}
.rank-card .no{font-weight:700;margin-bottom:4px;color:var(--ink-soft)}
.rank-card p{margin:.35em 0 0;line-height:1.6}
.rank-card .meta{color:#9aa0bf;font-size:.92rem}

/* ä»Šæ—¥ã®è‰²ï¼ˆèª¬æ˜è¡Œé–“UPï¼†æ˜¼ã®å¯èª­æ€§ï¼‰ */
.color-card{
  background:#0f0f16;border:1px solid #292939;border-radius:12px;padding:12px 14px;margin:8px 0 12px;
}
.color-card .row{ display:flex; align-items:center; gap:12px; }
.color-card .dots{ display:flex; gap:8px; }
.color-card code{ background:rgba(255,255,255,.08); padding:2px 6px; border-radius:6px; }
.color-legend{ list-style:none; padding:0; margin:10px 0 0; }
.color-legend .row{ display:flex; align-items:center; gap:12px; }
.color-legend .dots{ display:flex; gap:8px; }
.color-explain{ line-height:1.9; }
.color-legend li{ background:#0f0f16;border:1px solid #292939;border-radius:12px;padding:10px 14px;margin:10px 0;color:#dce0f8;box-shadow:0 0 6px rgba(0,0,0,.35)}
.color-legend .meta{ color:#cbd1ee; font-size:.94rem; line-height:1.6 }
.color-legend .meta b{ color:#fff; font-weight:600 }
.color-legend .sw{ width:18px; height:18px; border-radius:50%; box-shadow:0 0 10px var(--lucky) }

/* æ˜¼ãƒ¢ãƒ¼ãƒ‰ */
body.day{ color: var(--ink-day) }
body.day section{ background: var(--card-day); color: var(--ink-day); border-color: var(--card-day-border) }
body.day h2{ border-left-color: var(--accent); color:#111 }
body.day .daily{ color:#111 }
body.day .rank-card{ background:#fff; border-color:#e6e6e6 }
body.day .rank-card .meta{ color:#667 }
body.day .color-explain{ color:#555 }
body.day .color-card{ background:#fff; border-color:#ddd }
body.day .color-card code{ background:#f1f3f5; color:#111 }
body.day .color-legend li{ background:#fff; border-color:#ddd; color:#333 }
body.day .color-legend .meta b{ color:#111 }
body.day .color-legend .meta{ color:#555 }

/* ã‚¯ã‚¤ãƒƒã‚¯å ã„ï¼ˆã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³é™å®šï¼‰ */
#quick-fortune.card{ background:var(--card); border:1px solid #222; border-radius:12px; padding:16px; }
#qf-form{ display:grid; gap:10px; grid-template-columns:1fr 1fr; align-items:end }
#qf-form label{ display:flex; flex-direction:column; gap:6px; font-size:.95rem }
#qf-form input{ appearance:none; border:1px solid #2a2a3a; background:#0f0f16; color:#eaeaf2; border-radius:8px; padding:9px 10px; font-size:1rem }
#qf-form button{ justify-self:start; margin-top:2px }
.qf-out{ margin-top:14px; display:grid; gap:10px }
.qf-card{ background:#0f0f16; border:1px solid #23232f; border-radius:10px; padding:12px }
.qf-ttl{ font-weight:700; color:var(--ink-soft); margin-bottom:6px }
.qf-list{ margin:0; padding-left:1.1em; line-height:1.8 }
.qf-row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
.qf-chip{ font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:.92rem; padding:2px 8px; border-radius:999px; background:#1a1a25; border:1px solid #2b2b3a }
.qf-sw{ width:18px; height:18px; border-radius:50%; box-shadow:0 0 10px var(--lucky) }
.qf-colors{ display:flex; gap:8px; align-items:center }
body.day #quick-fortune.card{ background:#fff; border-color:#ddd }
body.day #qf-form input{ background:#fff; color:#111; border-color:#ddd }
body.day .qf-card{ background:#fff; border-color:#e6e6e6 }
body.day .qf-ttl{ color:#667 }
.qf-tip{ color:#cbd1ee } body.day .qf-tip{ color:#555 }
@media (max-width:600px){ #qf-form{ grid-template-columns:1fr } .qf-row{ gap:8px } }
</style>
</head>

<body>
<header>
  <div class="sky">
    <div class="stars"></div>
    <div class="ripple"></div>
    <div class="moon" aria-hidden="true"></div>
    <h1 class="title">å¿ƒç¯ï½œå®™ã®ãƒªã‚ºãƒ å ã„</h1>
    <p class="date" id="dateLine">æœ¬æ—¥ï¼š</p>
    <p class="info" id="infoLine">å¹²æ”¯æ—¥ï¼šâ€”ã€€ä»Šå¤œã®æœˆï¼šâ€”</p>
    <button id="ambBtn" class="btn-ghost" type="button">å®‡å®™ã®å‘¼å¸ï¼šOFF</button>
  </div>
</header>

<main>
  <section><h2>ğŸŒ• ä»Šæ—¥ã®ç¯</h2><div class="daily" id="daily"></div></section>

  <section><h2>ğŸ¨ ä»Šæ—¥ã®è‰²</h2>
    <div class="color-card">
      <div class="row">
        <div class="dots">
          <span class="sw" id="lc1"></span>
          <span class="sw" id="lc2"></span>
          <span class="sw" id="lc3"></span>
        </div>
        <div class="meta"><b>ã‚«ãƒ©ãƒ¼</b> <code id="lcCode">#8888ff</code>ï¼ˆäº”è¡Œï¼š<span id="elemName">â€”</span>ï¼‰</div>
      </div>
    </div>
    <div class="daily color-explain">
      äº”è¡Œã«åŸºã¥ã„ã¦ã€ãã®æ—¥ã®ã€Œå·¡ã‚Šã€ã‚’æ•´ãˆã‚‹è‰²ã§ã™ã€‚<br>
      è‰²ã¯é£¾ã‚Šã§ã¯ãªãã€å¿ƒã¨ç’°å¢ƒã®â€œèª¿å¾‹ã‚­ãƒ¼â€ã€‚å¿…è¦ãªã‚‰èº«ã«ã¤ã‘ã‚‹ï¼ç”»é¢ã«æ˜ ã™ï¼ãƒãƒ¼ãƒˆã«ä¸€ç­†ã§OKã€‚
    </div>
    <ul class="color-legend">
      <li><div class="row"><div class="dots">
        <span class="sw" style="background:#2ecc71"></span><span class="sw" style="background:#27ae60"></span><span class="sw" style="background:#1abc9c"></span>
      </div><div class="meta"><b>æœ¨ï¼š</b>#2ecc71 â€” æˆé•·ãƒ»ç™ºå±•ãƒ»å„ªã—ã•ã€‚</div></div></li>
      <li><div class="row"><div class="dots">
        <span class="sw" style="background:#e74c3c"></span><span class="sw" style="background:#ff7a59"></span><span class="sw" style="background:#e67e22"></span>
      </div><div class="meta"><b>ç«ï¼š</b>#e74c3c â€” è¡Œå‹•ãƒ»æƒ…ç†±ãƒ»å‹‡æ°—ã€‚</div></div></li>
      <li><div class="row"><div class="dots">
        <span class="sw" style="background:#f1c40f"></span><span class="sw" style="background:#f39c12"></span><span class="sw" style="background:#d4a373"></span>
      </div><div class="meta"><b>åœŸï¼š</b>#f1c40f â€” å®‰å®šãƒ»æ•´ãˆã‚‹åŠ›ã€‚</div></div></li>
      <li><div class="row"><div class="dots">
        <span class="sw" style="background:#ecf0f1"></span><span class="sw" style="background:#d4af37"></span><span class="sw" style="background:#bdc3c7"></span>
      </div><div class="meta"><b>é‡‘ï¼š</b>#ecf0f1 â€” æ´—ç·´ãƒ»æ‰‹æ”¾ã—ãƒ»ç£¨ãã€‚</div></div></li>
      <li><div class="row"><div class="dots">
        <span class="sw" style="background:#3498db"></span><span class="sw" style="background:#2980b9"></span><span class="sw" style="background:#34495e"></span>
      </div><div class="meta"><b>æ°´ï¼š</b>#3498db â€” ã¤ãªãŒã‚Šãƒ»å·¡ã‚Šã€‚</div></div></li>
    </ul>
  </section>

  <section><h2>ğŸª å®™ã®å¤©æ°—ï¼ˆå¹²æ”¯Ã—äº”è¡Œï¼‰</h2><div class="daily" id="weather"></div></section>
  <section><h2>ğŸ“… é€±é–“ã®å®™ä¾¿ã‚Š</h2><div class="daily" id="weekly"></div></section>
  <section><h2>ğŸŒ— ä»Šæœˆã®ãƒªã‚ºãƒ </h2><div class="daily" id="monthly"></div></section>
  <section><h2>ğŸŒ  å¹²æ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2><div id="rankingWrap"></div></section>

  <!-- ğŸ§­ ã‚¯ã‚¤ãƒƒã‚¯å ã„ï¼ˆç”Ÿå¹´æœˆæ—¥ï¼‰ -->
  <section id="quick-fortune" class="card">
    <h2>ğŸ§­ ç”Ÿå¹´æœˆæ—¥ã§ã‚¯ã‚¤ãƒƒã‚¯å ã„</h2>
    <form id="qf-form" autocomplete="off">
      <label>ç”Ÿå¹´æœˆæ—¥
        <input type="date" id="qf-bday" required>
      </label>
      <label>èª•ç”Ÿæ™‚é–“ï¼ˆä»»æ„ï¼‰
        <input type="time" id="qf-btime">
      </label>
      <label>ãŠåå‰ï¼ˆä»»æ„ï¼‰
        <input type="text" id="qf-uname" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ OK">
      </label>
      <button class="btn-ghost" type="submit">å ã†</button>
    </form>
    <div id="qf-out" class="qf-out" aria-live="polite"></div>
  </section>
</main>

<footer>Â© å¿ƒç¯ â€“ å®™ã®ãƒªã‚ºãƒ å ã„</footer>

<script>
/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
const pad = n => String(n).padStart(2,"0");
const W = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
const order=["æœ¨","ç«","åœŸ","é‡‘","æ°´"]; // ç›¸ç”Ÿ
const genNext=e=>order[(order.indexOf(e)+1)%5];
const genPrev=e=>order[(order.indexOf(e)+4)%5];

function fetchMaybe(path){ return fetch(path,{cache:"no-store"}).then(r=>r.ok?r.text():"").catch(()=> ""); }

/* ===== å¹²æ”¯ï¼ˆæ—¥ãƒ»å¹´ï¼‰/ äº”è¡Œ / æœˆç›¸ ===== */
function etoOfDay(y,m,d){
  const T=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"], Z=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
  const a=Math.floor((14-m)/12); y=y+4800-a; m=m+12*a-3;
  const j=d+Math.floor((153*m+2)/5)+365*y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400)-32045;
  return T[(j+9)%10] + Z[(j+1)%12];
}
function approxRisshunJST(year){
  const baseDay=4; const offset=((year%4)===0)? -0.3 : ((year%4)===1? 0 : -0.1);
  const hh=Math.floor((10+offset)*1); // AM10æ™‚è¿‘è¾º
  return new Date(`${year}-02-${pad(baseDay)}T${pad(hh)}:00:00+09:00`);
}
function etoOfYearByRisshun(dateJST){
  const y=dateJST.getFullYear();
  const risshun=approxRisshunJST(y);
  const yearForEto = (dateJST < risshun) ? (y-1) : y;
  const T=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"], Z=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
  const base=1984; // ç”²å­å¹´
  const idx=(yearForEto-base)%60;
  const ti=(idx>=0?idx:idx+60)%10, zi=(idx>=0?idx:idx+60)%12;
  return { year:T[ti]+Z[zi], refYear:yearForEto };
}
function elemFromStem(st){ if("ç”²ä¹™".includes(st))return"æœ¨"; if("ä¸™ä¸".includes(st))return"ç«"; if("æˆŠå·±".includes(st))return"åœŸ"; if("åºšè¾›".includes(st))return"é‡‘"; return"æ°´"; }
const branchElem={å­:"æ°´",ä¸‘:"åœŸ",å¯…:"æœ¨",å¯:"æœ¨",è¾°:"åœŸ",å·³:"ç«",åˆ:"ç«",æœª:"åœŸ",ç”³:"é‡‘",é…‰:"é‡‘",æˆŒ:"åœŸ",äº¥:"æ°´"};
const branchEmoji={å­:"ğŸ­",ä¸‘:"ğŸ®",å¯…:"ğŸ¯",å¯:"ğŸ°",è¾°:"ğŸ²",å·³:"ğŸ",åˆ:"ğŸ´",æœª:"ğŸ‘",ç”³:"ğŸµ",é…‰:"ğŸ”",æˆŒ:"ğŸ¶",äº¥:"ğŸ—"};
const branches=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];

function moonEmoji(date){
  const syn=29.530588853, base=new Date(Date.UTC(2000,0,6,18,14));
  const diff=(date-base)/86400000, ph=((diff%syn)+syn)%syn;
  if(ph<1.5)return"ğŸŒ‘"; if(ph<6)return"ğŸŒ’"; if(ph<8)return"ğŸŒ“"; if(ph<14)return"ğŸŒ”";
  if(ph<16)return"ğŸŒ•"; if(ph<21)return"ğŸŒ–"; if(ph<23)return"ğŸŒ—"; return"ğŸŒ˜";
}
function luckyColorByElement(elem, weekday){
  const colors={
    "æœ¨":["#2ecc71","#27ae60","#1abc9c","#16a085","#23b27e","#3bd199","#2fa36b"],
    "ç«":["#e74c3c","#ff7a59","#ff6b81","#ff9f43","#e67e22","#e85d6a","#ff5e3a"],
    "åœŸ":["#f1c40f","#f39c12","#d4a373","#c09f62","#b08968","#e1ad01","#dcb159"],
    "é‡‘":["#ecf0f1","#bdc3c7","#f5f1e3","#f4d03f","#d1ccc0","#d4af37","#c0c0c0"],
    "æ°´":["#3498db","#2980b9","#6c5ce7","#34495e","#1f6feb","#3a86ff","#2b2d42"]
  };
  const list=colors[elem]||colors["æ°´"]; return list[new Date().getDay()%list.length];
}

/* ===== ç”»é¢åˆæœŸåŒ– ===== */
(async ()=>{
  // JST ç¾åœ¨
  const now = new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Tokyo"}));
  const Y=now.getFullYear(), M=now.getMonth()+1, D=now.getDate(), H=now.getHours(), Wn=now.getDay();
  document.body.classList.toggle("night", (H>=18||H<6));
  document.body.classList.toggle("day", !(H>=18||H<6));

  // æ—¥å¹²æ”¯ãƒ»æœˆç›¸ãƒ»è‰²
  const eto = etoOfDay(Y,M,D);
  const elem = elemFromStem(eto[0]);
  const moon = moonEmoji(now);
  const col = luckyColorByElement(elem, Wn);

  // ãƒ’ãƒ¼ãƒ­ãƒ¼è¡¨ç¤º
  document.getElementById("dateLine").textContent = `æœ¬æ—¥ï¼š${Y}å¹´${M}æœˆ${D}æ—¥ï¼ˆ${W[Wn]}ï¼‰`;
  document.getElementById("infoLine").textContent = `å¹²æ”¯æ—¥ï¼š${eto}ï¼ˆäº”è¡Œï¼š${elem}ï¼‰ã€€ä»Šå¤œã®æœˆï¼š${moon}`;
  document.querySelector('meta[name="theme-color"]').setAttribute("content", col);

  // ä»Šæ—¥ã®è‰² UI
  const lc1=document.getElementById("lc1"), lc2=document.getElementById("lc2"), lc3=document.getElementById("lc3");
  lc1.style.background=col; lc2.style.background=col+"cc"; lc3.style.background=col+"88";
  document.getElementById("lcCode").textContent = col;
  document.getElementById("elemName").textContent = elem;

  // ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ï¼ˆç„¡ã‘ã‚Œã°è‡ªå‹•æ–‡ï¼‰
  const daily = await fetchMaybe("daily.txt") || "ï¼ˆä»Šæ—¥ã®ç¯ã¯æº–å‚™ä¸­ã§ã™ï¼‰";
  const weather = await fetchMaybe("eto-ranking.txt") || "ï¼ˆå®™ã®å¤©æ°—ã¯æº–å‚™ä¸­ã§ã™ï¼‰";
  document.getElementById("daily").textContent = daily.trim();
  document.getElementById("weather").textContent = weather.trim();

  // é€±ãƒ»æœˆ è‡ªå‹•æ–‡
  function autoWeekly(elem, moon){
    const tone = {æœ¨:"èŠ½ã‚’ä¼¸ã°ã™â€œèª¿å¾‹é€±é–“â€ã€‚å°ã•ãªæˆé•·ã‚’ç©ã¿é‡ã­ã¦ã€‚",ç«:"æƒ…ç†±ã‚’é…ã‚‹é€±ã€‚æ¸©åº¦å·®ã«æ³¨æ„ã€ç«ã®ç²‰ã¯æ‰•ã£ã¦å‰ã€‚",åœŸ:"è¶³å ´å›ºã‚ã€‚äºˆå®šã‚’3ã¤ã«çµã‚‹ã»ã©é‹ãŒé€šã‚‹ã€‚",é‡‘:"æ•´ãˆã‚‹ï¼†æ‰‹æ”¾ã™ã€‚ç£¨ãã»ã©å…‰ã‚‹é€±ã€‚",æ°´:"æµã‚Œã«ä¹—ã‚‹ã€‚ã—ãªã‚„ã‹ã«æ–¹å‘è»¢æ›ã§é–‹é‹ã€‚"}[elem];
    const moonHint = /ğŸŒ•/.test(moon)?"æº€ã¡ãŸæœˆã€‚ä»•ä¸Šã’ã¨ç™ºä¿¡ãŒâ—":/ğŸŒ‘/.test(moon)?"æ–°æœˆæœŸã€‚å§‹å‹•ã¨å®£è¨€ãŒå‰ã€‚":/ğŸŒ“|ğŸŒ—/.test(moon)?"åŠæœˆæœŸã€‚ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ã«ãƒ„ã‚­ã€‚":"ã‚†ã‚‹ãæº€ã¡æ¬ ã‘ã€‚å¿ƒèº«ã®ãƒªã‚ºãƒ ã«è€³ã‚’ã€‚";
    return `ç·è©•ï¼š${tone}\næœˆç›¸ï¼š${moonHint}\néµï¼šé€£çµ¡ãƒ»æ•´é “ãƒ»æ·±å‘¼å¸`;
  }
  function autoMonthly(month, elem){
    const season=(month>=3&&month<=5)?"æ˜¥":(month>=6&&month<=8)?"å¤":(month>=9&&month<=11)?"ç§‹":"å†¬";
    const guide={æ˜¥:"èŠ½å¹ãã€‚æ–°ã—ã„ç¿’æ…£ã‚’â€œ1ã¤ã ã‘â€å¢—ã‚„ã™ã€‚",å¤:"ç†±ã‚’é…åˆ†ã€‚é ‘å¼µã‚‹æ‰€ã¨ä¼‘ã‚€æ‰€ã‚’åˆ†ã‘ã¦â—",ç§‹:"ä»•ä¸Šã’ã¨åç©«ã€‚è¨˜éŒ²ã¨æŒ¯ã‚Šè¿”ã‚ŠãŒè²¡ç”£ã«ã€‚",å†¬:"è“„ãˆã‚‹æœˆã€‚ä½“ã‚’æ¸©ã‚ã€è¨ˆç”»ã‚’ç£¨ãã€‚"}[season];
    const elemLine={æœ¨:"æœ¨ï¼ˆä¼¸ã³ã‚‹åŠ›ï¼‰ï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ»å­¦ã³æ—¥å’Œã€‚",ç«:"ç«ï¼ˆåºƒãŒã‚‹åŠ›ï¼‰ï¼šç™ºä¿¡ã®è³ªã‚’ä¸Šã’ã‚‹ã€‚",åœŸ:"åœŸï¼ˆæ•´ãˆã‚‹åŠ›ï¼‰ï¼šç‰‡ã¥ã‘ãŒé‡‘é‹ã®ã‚«ã‚®ã€‚",é‡‘:"é‡‘ï¼ˆç£¨ãåŠ›ï¼‰ï¼šè¡£é£Ÿä½ã®â€œè³ªâ€ã‚’1ç‚¹æ›´æ–°ã€‚",æ°´:"æ°´ï¼ˆã¤ãªãåŠ›ï¼‰ï¼šå¯¾è©±ã¨æ•£æ­©ã§å·¡ã‚Šè‰¯ã—ã€‚"}[elem];
    return `å­£ç¯€ï¼š${season}\næ–¹é‡ï¼š${guide}\näº”è¡Œãƒ’ãƒ³ãƒˆï¼š${elemLine}`;
  }
  const weekly = await fetchMaybe("weekly.txt") || autoWeekly(elem, moon);
  const monthly = await fetchMaybe("monthly.txt") || autoMonthly(M, elem);
  document.getElementById("weekly").textContent = weekly.trim();
  document.getElementById("monthly").textContent = monthly.trim();

  // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼šãƒ†ã‚­ã‚¹ãƒˆå„ªå…ˆâ†’ç„¡ã‘ã‚Œã°è‡ªå‹•ã‚«ãƒ¼ãƒ‰
  const rankTxt = await fetchMaybe("ranking.txt");
  const wrap = document.getElementById("rankingWrap");
  if(rankTxt.trim()){
    const pre = document.createElement("pre");
    pre.className="daily";
    pre.textContent = rankTxt.trim();
    wrap.innerHTML=""; wrap.appendChild(pre);
  }else{
    function seededRand(seed){ let x=Math.sin(seed)*10000; return x-Math.floor(x); }
    const be = b=>branchElem[b];
    const seedBase = Y*10000+M*100+D;
    const msgs = ["å‹¢ã„ã«ä¹—ã‚Œã‚‹ã€‚å…ˆæ‰‹å¿…å‹ã€‚","ã²ã‚‰ã‚ãå¥½èª¿ã€‚çŸ­æœŸæ±ºæˆ¦â—","ä¿¡ç”¨ãŒé‹ã‚’é€£ã‚Œã¦ãã‚‹ã€‚","èª¿å’Œé‹ã€‚èãå½¹ãŒå‰ã€‚","å …å®Ÿé‹ã€‚ç©ã¿ä¸Šã’ã«ç¦ã€‚","æƒ…å ±é‹ã€‚ã¾ãšã¯é€£çµ¡ã‹ã‚‰ã€‚","ã‚±ã‚¸ãƒ¡ã§å¥½è»¢ã€‚åˆ‡ã‚Šæ›¿ãˆåŠ›ã€‚","ä½“èª¿ã‚±ã‚¢ã§é‹æ°—ç¶­æŒã€‚","ç„¦ã‚‰ãšæ•´ãˆã‚‹æ—¥ã€‚","è¨€è‘‰é¸ã³ã‚’ä¸å¯§ã«ã€‚","æº–å‚™ãŒå‹ã¡ã€‚ä¸‹åœ°ã¥ãã‚Šã€‚","å°ã•ãªå„ªã—ã•ãŒå¤§ããªç¸ã€‚"];
    function score(b,i){
      const e=be(b); let s=70+Math.floor(seededRand(seedBase+i)*21)-10;
      if(e===elem)s+=8; if(genNext(e)===elem)s+=5; if(genNext(elem)===e)s+=3;
      return Math.max(55,Math.min(99,s));
    }
    const picks = branches.map((b,i)=>({b,emoji:branchEmoji[b],elem:be(b),score:score(b,i),msg:msgs[(Math.floor(seededRand(seedBase+99)*msgs.length)+i)%msgs.length]})).sort((a,b)=>b.score-a.score);
    const grid=document.createElement("div"); grid.className="rank-grid";
    grid.innerHTML = picks.map((o,idx)=>`<article class="rank-card"><div class="no">#${idx+1} ${o.b}ï¼ˆ${o.emoji}ï¼‰</div><p>${o.msg}</p><p class="meta">ãƒ©ãƒƒã‚­ãƒ¼ï¼š${o.elem}ã®æ°—ã‚’å…¥ã‚Œã‚‹ï¼å°ç‰©ï¼‘ç‚¹</p></article>`).join("");
    wrap.innerHTML=""; wrap.appendChild(grid);
  }
})();

/* ===== å®‡å®™ã®å‘¼å¸ï¼ˆã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆON/OFFï¼‰ ===== */
(()=>{let ctx,gain,osc,lfo,lfoGain;const btn=document.getElementById('ambBtn');
function ensure(){if(ctx)return;const AC=window.AudioContext||window.webkitAudioContext;ctx=new AC();
gain=ctx.createGain();gain.gain.value=0.0001;osc=ctx.createOscillator();osc.type='sine';osc.frequency.value=110;
lfo=ctx.createOscillator();lfo.type='sine';lfo.frequency.value=0.08;lfoGain=ctx.createGain();lfoGain.gain.value=0.15;
lfo.connect(lfoGain).connect(gain.gain);osc.connect(gain).connect(ctx.destination);osc.start();lfo.start();}
btn.addEventListener('click',async()=>{ensure();if(ctx.state==='suspended')await ctx.resume();
const on=btn.dataset.playing==='1';if(on){gain.gain.setTargetAtTime(0.0001,ctx.currentTime,0.8);btn.dataset.playing='0';btn.textContent='å®‡å®™ã®å‘¼å¸ï¼šOFF';}
else{gain.gain.setTargetAtTime(0.06,ctx.currentTime,1.2);btn.dataset.playing='1';btn.textContent='å®‡å®™ã®å‘¼å¸ï¼šON';}});})();

/* ===== ç”Ÿå¹´æœˆæ—¥ã‚¯ã‚¤ãƒƒã‚¯å ã„ ===== */
(function(){
  const out = document.getElementById("qf-out");
  function moonEmoji(date){
    const syn=29.530588853, base=new Date(Date.UTC(2000,0,6,18,14));
    const diff=(date-base)/86400000, ph=((diff%syn)+syn)%syn;
    if(ph<1.5)return"ğŸŒ‘"; if(ph<6)return"ğŸŒ’"; if(ph<8)return"ğŸŒ“"; if(ph<14)return"ğŸŒ”"; if(ph<16)return"ğŸŒ•"; if(ph<21)return"ğŸŒ–"; if(ph<23)return"ğŸŒ—"; return"ğŸŒ˜";
  }
  function luckyColorByElement(elem, weekday){
    const colors={"æœ¨":["#2ecc71","#27ae60","#1abc9c"],"ç«":["#e74c3c","#ff7a59","#e67e22"],"åœŸ":["#f1c40f","#f39c12","#d4a373"],"é‡‘":["#ecf0f1","#d4af37","#bdc3c7"],"æ°´":["#3498db","#2980b9","#34495e"]};
    const list=colors[elem]||colors["æ°´"]; return list[new Date().getDay()%list.length];
  }
  document.getElementById("qf-form").addEventListener("submit", (e)=>{
    e.preventDefault();
    const nm=(document.getElementById("qf-uname").value.trim()||"ã‚ãªãŸ");
    const bday=document.getElementById("qf-bday").value; if(!bday)return;
    const bJST = new Date(`${bday}T00:00:00+09:00`);
    const y=bJST.getFullYear(), m=bJST.getMonth()+1, d=bJST.getDate();
    const dayEto = etoOfDay(y,m,d);
    const {year:yearEto, refYear} = etoOfYearByRisshun(bJST);
    const birthElem = elemFromStem(yearEto[0]);
    const today = new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Tokyo"}));
    const todayEto = etoOfDay(today.getFullYear(), today.getMonth()+1, today.getDate());
    const todayElem = elemFromStem(todayEto[0]);
    const col = luckyColorByElement(birthElem, today.getDay());
    const moon = moonEmoji(today);
    const compat = (birthElem===todayElem)?"â—ï¼ˆåŒè³ªãƒ»å…±é³´ï¼‰":(genNext(birthElem)===todayElem||genPrev(birthElem)===todayElem)?"â—‹ï¼ˆç›¸ç”Ÿãƒ»å¾ªç’°ï¼‰":"â–³ï¼ˆç›¸å‰‹ãƒ»ç”¨å¿ƒï¼‰";
    const tipMoon = /ğŸŒ•/.test(moon)?"ä»•ä¸Šã’ï¼†ç™ºä¿¡â—":/ğŸŒ‘/.test(moon)?"é™ã‹ã«å§‹å‹•ãƒ»å®£è¨€å‰":/ğŸŒ“|ğŸŒ—/.test(moon)?"èª¿æ•´ã¨ãƒãƒ©ãƒ³ã‚¹":"æµã‚Œã«ä¹—ã‚‹";
    out.innerHTML = `
      <div class="qf-card"><div class="qf-ttl">åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
        <ul class="qf-list"><li>${nm}ã®å¹´å¹²æ”¯ï¼š<b>${yearEto}</b> <span class="qf-chip">äº”è¡Œï¼š${birthElem}</span> <span class="qf-chip">${refYear}å¹´åŸºæº–ï¼ˆç«‹æ˜¥åˆ‡æ›¿ï¼‰</span></li>
        <li>ç”Ÿã¾ã‚Œã®æ—¥å¹²æ”¯ï¼š<b>${dayEto}</b></li></ul></div>
      <div class="qf-card"><div class="qf-ttl">æœ¬æ—¥ã®ç›¸æ€§</div>
        <ul class="qf-list"><li>ä»Šæ—¥ã®å¹²æ”¯ï¼š<b>${todayEto}</b>ï¼äº”è¡Œï¼š<b>${todayElem}</b></li><li>ç›¸æ€§ï¼š<b>${compat}</b></li></ul></div>
      <div class="qf-card"><div class="qf-ttl">ä»Šæ—¥ã®è‰²ãƒ»æœˆç›¸</div>
        <div class="qf-row"><span class="qf-colors"><span class="qf-sw" style="background:${col}"></span><span class="qf-sw" style="background:${col}cc"></span><span class="qf-sw" style="background:${col}88"></span></span>
        <span class="qf-chip">${col}</span><span class="qf-chip">æœˆç›¸ï¼š${moon} ${tipMoon}</span><span class="qf-tip">ï¼ˆäº”è¡Œï¼š${birthElem}ã®å·¡ã‚Šã‚’æ•´ãˆã‚‹ï¼‰</span></div></div>
      <div class="qf-card"><div class="qf-ttl">ãƒ’ãƒ³ãƒˆ</div>
        <ul class="qf-list"><li>${birthElem==="æœ¨"?"â€œä¼¸ã°ã™â€ã‚’1ã¤ã ã‘å¢—ã‚„ã™":"è¦ã‚‰ãªã„ã‚‚ã®ã‚’1ã¤æ‰‹æ”¾ã™"}</li><li>é€£çµ¡ï¼æ•´é “ï¼æ·±å‘¼å¸ ã®â€œ3ç‚¹ã‚»ãƒƒãƒˆâ€ã§é‹ã®é€šã‚Šé“ã‚’ä½œã‚‹</li></ul></div>`;
  });
})();
</script>
</body>
</html>
